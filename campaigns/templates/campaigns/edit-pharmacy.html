<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="Description" content="">
    <meta name="Author" content="PywE">
    <meta name="keywords" content="" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <link rel="icon" href="/static/images/brand/logo.svg" type="image/x-icon" />
    <link rel="shortcut icon" type="image/x-icon" href="/static/images/brand/logo.svg" />

    <!-- Title -->
    <title>POP Ghana | Edit Pharmacy</title>

    <!-- Bootstrap Css -->
    <link href="/static/plugins/bootstrap-4.3.1-dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Dashboard Css -->
    <link href="/static/css/style.css" rel="stylesheet" />

    <!-- Font-awesome  Css -->
    <link href="/static/css/icons.css" rel="stylesheet" />

    <!--Horizontal Menu-->
    <!--<link href="/static/plugins/horizontal/horizontal-menu/animation/fade-down.css" rel="stylesheet" />-->
    <!--<link href="/static/plugins/horizontal/horizontal-menu/horizontal.css" rel="stylesheet" />-->

    <!--Select2 Plugin -->
    <!--<link href="/static/plugins/select2/select2.min.css" rel="stylesheet" />-->

    <!-- Owl Theme css-->
    <!--<link href="/static/plugins/owl-carousel/owl.carousel.css" rel="stylesheet" />-->

    <!-- Cookie css -->
    <!--<link href="/static/plugins/cookie/cookie.css" rel="stylesheet">-->

    <!--Semantic UI css-->
    <link rel="stylesheet" href="/static/plugins/Semantic-UI-CSS/semantic.min.css">

    <!-- Custom scroll bar css-->
    <link href="/static/plugins/scroll-bar/jquery.mCustomScrollbar.css" rel="stylesheet" />

    <!-- COLOR-SKINS -->
    <link id="theme" rel="stylesheet" type="text/css" media="all" href="/static/color-skins/color-skins/color10.css" />
</head>

<body onload="initForm();">
    <!--Sliders Section-->
    <section>
        <div class="bannerimg cover-image bg-background3" data-image-src="/static/images/banners/banner2.jpg">
            <div class="header-text mb-0">
                <div class="container">
                    <div class="text-center text-white">
                        <h1 class="">Edit Pharmacy</h1>
                        <ol class="breadcrumb text-center">
                            <li class="breadcrumb-item"><strong id="username" app-variable="username"></strong>
                            </li>
                            <li class="breadcrumb-item"><a href="/">Campaign List</a></li>
                            <li class="breadcrumb-item"><a href="/campaigns/observation-session"><span id="global_name"
                                        app-variable="campaign-name"></span></a></li>
                            <li class="breadcrumb-item"><a href="/campaigns/new-session"><span id="session_name"
                                        app-variable="campaign-name"></span></a></li>
                            <li class="breadcrumb-item active text-white" aria-current="page">Edit Pharmacy</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--/Sliders Section-->

    <!--Pharmacy-Pharmacist-details-section-->
    <br><br>
    <div class="ui container">
        <form id="pharmform" onsubmit="savePharmacy()" method="dialog" class="ui form">
            <div class="ui raised segments">
                <div class="ui segment">
                    <div class="ui header">Pharmacy</div>
                </div>
                <div class="ui secondary segment">
                    <div class="three fields">
                        <div class="field">
                            <label>Name</label>
                            <div class="ui search pharmacy">
                            <div class="ui input">
                                <input class="prompt" id="pharmacy_name" name="name" autocomplete="off" placeholder="Search Pharmacy" type="text" required>
                            </div>
                            <div class="results"></div>
                            </div>
                        </div>

                        <div class="field">
                            <label>Mobile phone number of the followed Pharmacist (vendor).</label>
                            <div class="ui input">
                                <input name="contact" type="text" maxlength="14" required>
                            </div>
                        </div>

                        <div class="field">
                            <label>Detailed Address <span class="ui text small">
                                    Make this detailed to easily find
                                    pharmacy.</span></label>
                            <div class="ui input">
                                <textarea name="detailed_address" rows="1" required></textarea>
                            </div>

                        </div>
                    </div>

                    <div class="four fields">
                        <div class="field">
                            <label>District social standard</label>
                            <select id="dss" name="district_social_standard" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>

                        <div class="field">
                            <label>Is Conselling Available?</label>
                            <select id="counselling" name="counselling" class="ui dropdown" required>
                                <option value="">Choose</option>
                                <option value="True">Yes</option>
                                <option value="False">No</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Is Pharmacy Computerized?</label>
                            <select id="computerized" name="computerized" class="ui dropdown" required>
                                <option value="">Choose</option>
                                <option value=True>Yes</option>
                                <option value=False>No</option>
                            </select>
                        </div>

                        <div class="field">
                            <label>Is Pharmacy Dependent On a Hospital?</label>
                            <select id="dependent_on_hospital" name="dependent_on_hospital" class="ui dropdown" required>
                                <option value="">Choose</option>
                                <option value=True>Yes</option>
                                <option value=False>No</option>
                            </select>
                        </div>
                    </div>
                    <div class="three fields">
                        <div class="field" id="staff_mostly_followed">
                            <label>Staff mostly followed</label>
                            <select id="smf" name="staff_mostly_followed" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>

                        <div class="field"  id="staff_mostly_present">
                            <label>Staff mostly present</label>
                            <select id="smp" name="staff_mostly_present" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Email of pharmacy</label>
                            <div class="ui input">
                                <input name="email" type="email" maxlength="200" required>
                            </div>
                        </div>
                        <div class="field" id="area_name">
                            <label>Area Name</label>
                            <select id="an" name="area_name" class="ui search dropdown" required>
                                <option value="">Area Name</option>
                            </select>
                        </div>
                    </div>

                    <div class="three fields">
                        <div class="field">
                            <label>Average number of patients
                                visiting the pharmacy per day</label>
                            <div class="ui right labeled input">
                                <input name="average_patients_per_day" type="number" min="1" required>
                                <div class="ui basic label">
                                    Patients
                                </div>
                            </div>
                        </div>
                        <div class="field" id="insurance_convention">
                            <label>Insurance convention</label>
                            <select id="ic" name="insurance_convention" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>
                        <div class="field" id="pharmacy_standard">
                            <label>Pharmacy standard</label>
                            <select id="ps" name="pharmacy_standard" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>
                    </div>

                    <div class="three fields">
                        <div class="field" id="district_profile">
                            <label>District profile</label>
                            <select id="profs" name="district_profile" class="ui dropdown" required>
                                <option value="">Choose</option>
                            </select>
                        </div>
                        <div id="tests_available" class="field">
                           <label>Tests available</label>
                             <select id="tests" name="tests_available" class="ui search multiple dropdown">
                                 <option value="">Find</option>
                             </select>
                        </div>
                        <div class="field">
                            <label>Comments <span class="ui text small">
                                    Any
                                    other things we should take notice of...</span></label>
                            <div class="ui input">
                                <textarea name="comments" rows="1"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ui raised segments">
                <div class="ui segment">
                    <div class="ui header">Pharmacist</div>
                </div>
                <div class="ui secondary segment">
                    <div class="two fields">
                        <div class="field">
                            <label>First Name</label>
                            <div class="ui input">
                                <input name="pharmacist_first_name" type="text" maxlength="150" required>
                            </div>
                        </div>
                        <div class="field">
                            <label>Last Name</label>
                            <div class="ui input">
                                <input name="pharmacist_last_name" type="text" maxlength="150" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    <div class="ui horizontal divider">
        <button type="submit" class="positive ui big submit button">
            Save <i class="icon save right"></i>
        </button>
        <span class="grayed" style="display: none;">
            <i class="ui wait icon"></i>
            Saving.. </span>
    </div>
    </form>
    </div>
    <!--/Pharmacy-Pharmacist-details-section-->



    <!-- Back to top -->
    <a href="#top" id="back-to-top"><i class="fa fa-arrow-up"></i></a>

    <!-- JQuery js-->
    <script src="/static/js/vendors/jquery-3.2.1.min.js"></script>

    <!-- Bootstrap js -->
    <script src="/static/plugins/bootstrap-4.3.1-dist/js/popper.min.js"></script>
    <script src="/static/plugins/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>

    <!--JQuery Sparkline Js-->
    <!--<script src="/static/js/vendors/jquery.sparkline.min.js"></script>-->

    <!--Semantic js-->
    <!--<script src="/static/plugins/Semantic-UI-CSS/semantic.js"></script>-->
    <script src="/static/plugins/Semantic-UI-CSS/semantic.min.js"></script>

    <!-- Circle Progress Js-->
    <script src="/static/js/vendors/circle-progress.min.js"></script>

    <!-- Star Rating Js-->
    <!--<script src="/static/plugins/rating/jquery.rating-stars.js"></script>-->

    <!--Owl Carousel js -->
    <!--<script src="/static/plugins/owl-carousel/owl.carousel.js"></script>-->

    <script src="/static/plugins/dexie/dexie.js"></script>

    <!--Horizontal Menu-->
    <!--<script src="/static/plugins/horizontal/horizontal-menu/horizontal.js"></script>-->

    <!--Counters -->
    <!--<script src="/static/plugins/counters/counterup.min.js"></script>-->
    <!--<script src="/static/plugins/counters/waypoints.min.js"></script>-->

    <!--JQuery TouchSwipe js-->
    <!--<script src="/static/js/jquery.touchSwipe.min.js"></script>-->

    <!--Select2 js -->
    <!--<script src="/static/plugins/select2/select2.full.min.js"></script>-->
    <!--<script src="/static/js/select2.js"></script>-->

    <!-- Cookie js -->
    <!--<script src="/static/plugins/cookie/jquery.ihavecookies.js"></script>-->
    <!--<script src="/static/plugins/cookie/cookie.js"></script>-->

    <!-- Count Down-->
    <!--<script src="/static/plugins/count-down/jquery.lwtCountdown-1.0.js"></script>-->

    <!-- Ion.RangeSlider -->
    <!--<script src="/static/plugins/jquery-uislider/jquery-ui.js"></script>-->

    <!-- Custom scroll bar Js-->
    <script src="/static/plugins/scroll-bar/jquery.mCustomScrollbar.concat.min.js"></script>

    <!-- sticky Js-->
    <!--<script src="/static/js/sticky.js"></script>-->

    <!-- Swipe Js-->
    <!--<script src="/static/js/swipe.js"></script>-->

    <!-- Scripts Js-->
    <!--<script src="/static/js/scripts2.js"></script>-->

    <!-- Ion.RangeSlider -->
    <!--<script src="/static/plugins/jquery-uislider/jquery-ui.js"></script>-->

    <!--Showmore Js-->
    <!--<script src="/static/js/jquery.showmore.js"></script>-->
    <!--<script src="/static/js/showmore.js"></script>-->

    <!-- Custom Js-->
    <script src="/static/js/custom.js"></script>




    <script>

        window.onload = function Load() {
            if (isLoggedIn()) {
                //   redirect user to campaign list or last page
                // Get user's country and fetch appropriate list

window.pharmac = []
                db.backdata.get('pharmacies', function (pharma){

    for (let i = 0; i < pharma.data.length; i++) {

        window.pharmac.push({
        title: pharma.data[i].name,
    });
}
$('.pharmacy').search({
    source : window.pharmac,
    searchFields   : [
      'title'
    ],
    fullTextSearch: true,

  });
})



                db.backdata.get('district_standards', function (standards){

    for (let i = 0; i < standards.data.length; i++) {
        $('#dss').append($('<option>', {
        value: standards.data[i].name,
        text : standards.data[i].name
    }));
  $('#district_social_standard > > .menu').append(`<div class="item" data-value="`+standards.data[i].name+`">`+standards.data[i].name+`</div>`);
}
})

  db.backdata.get('staff_followed', function (staff){

    for (let i = 0; i < staff.data.length; i++) {
        $('#smf').append($('<option>', {
        value: staff.data[i].name,
        text : staff.data[i].name
    }));
  $('#staff_mostly_followed > > .menu').append(`<div class="item" data-value="`+staff.data[i].name+`">`+staff.data[i].name+`</div>`);
}
})

db.backdata.get('staff_followed', function (staff){

    for (let i = 0; i < staff.data.length; i++) {
        $('#smp').append($('<option>', {
        value: staff.data[i].name,
        text : staff.data[i].name
    }));
  $('#staff_mostly_present > > .menu').append(`<div class="item" data-value="`+staff.data[i].name+`">`+staff.data[i].name+`</div>`);
}
})

db.backdata.get('insurance_types', function (types){

    for (let i = 0; i < types.data.length; i++) {
        $('#ic').append($('<option>', {
        value: types.data[i].name,
        text : types.data[i].name
    }));
  $('#insurance_convention > > .menu').append(`<div class="item" data-value="`+types.data[i].name+`">`+types.data[i].name+`</div>`);
}
})

db.backdata.get('pharmacy_standards', function (grades){

    for (let i = 0; i < grades.data.length; i++) {
        $('#ps').append($('<option>', {
        value: grades.data[i].name,
        text : grades.data[i].name
    }));
  $('#pharmacy_standard > > .menu').append(`<div class="item" data-value="`+grades.data[i].name+`">`+grades.data[i].name+`</div>`);
}
})


    db.backdata.get('districts', function (names){

    for (let i = 0; i < names.data.length; i++) {
        $('#an').append($('<option>', {
        value: names.data[i].id,
        text : names.data[i].name
    }));
//   $('#area_name > > .menu').append(`<div class="item" data-value="`+names.data[i].id+`">`+names.data[i].name+`</div>`);
}
})

db.backdata.get('available_tests', function (value){

    for (let i = 0; i < value.data.length; i++) {
        $('#tests').append($('<option>', {
        value: value.data[i].id,
        text : value.data[i].name
    }));
  $('#tests_available > > .menu').append(`<div class="item" data-value="`+value.data[i].name+`">`+value.data[i].name+`</div>`);
}
})

  db.backdata.get('district_profiles', function (profiles){

    for (let i = 0; i < profiles.data.length; i++) {
        $('#profs').append($('<option>', {
        value: profiles.data[i].name,
        text : profiles.data[i].name
    }));
  $('#district_profile > > .menu').append(`<div class="item" data-value="`+profiles.data[i].name+`" data-text="`+profiles.data[i].name+`">`+profiles.data[i].name+`</div>`);
}
})


console.log('done')
            var pharma_name = localStorage.getItem('pharmacy_name')
            db.pharmacies.get(pharma_name, function (pharma) {
                console.log(pharma)
                if (pharma.name !== "") {
                    document.forms[0].elements["name"].value = pharma.name
                    // $("#Gender option:contains(" + bask.basket.Gender + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.contact !== "") {
                    document.forms[0].elements["contact"].value = pharma.pharmacy_info.contact
                }
                if (pharma.pharmacy_info.detailed_address !== "") {
                    document.forms[0].elements["detailed_address"].value = pharma.pharmacy_info.detailed_address
                }
                if (pharma.pharmacy_info.district_social_standard !== "") {
                    $("#dss option:contains(" + pharma.pharmacy_info.district_social_standard + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.counselling !== "") {
                    $('#counselling').dropdown('set selected', pharma.pharmacy_info.counselling);
                    // $("#counselling option:contains(" + pharma.pharmacy_info.counselling + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.computerized !== "") {
                    $('#computerized').dropdown('set selected', pharma.pharmacy_info.computerized);
                    // $("#computerized option:contains(" + pharma.pharmacy_info.computerized + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.dependent_on_hospital !== "") {
                    $('#dependent_on_hospital').dropdown('set selected', pharma.pharmacy_info.dependent_on_hospital);
                    // $("#dependent_on_hospital option:contains(" + pharma.pharmacy_info.dependent_on_hospital + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.staff_mostly_followed !== "") {
                    $("#smf option:contains(" + pharma.pharmacy_info.staff_mostly_followed + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.staff_mostly_present !== "") {
                    $("#smp option:contains(" + pharma.pharmacy_info.staff_mostly_present + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.email !== "") {
                    document.forms[0].elements["email"].value = pharma.pharmacy_info.email
                }
                if (pharma.pharmacy_info.area_name !== "") {
                    $('#an').dropdown('set selected', pharma.pharmacy_info.area_name);
                    // $("#an option:contains(" + pharma.pharmacy_info.area_name + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.average_patients_per_day !== "") {
                    document.forms[0].elements["average_patients_per_day"].value = pharma.pharmacy_info.average_patients_per_day
                }
                if (pharma.pharmacy_info.insurance_convention !== "") {
                    $("#ic option:contains(" + pharma.pharmacy_info.insurance_convention + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.pharmacy_standard !== "") {
                    $("#ps option:contains(" + pharma.pharmacy_info.pharmacy_standard + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.district_profile !== "") {
                    $("#profs option:contains(" + pharma.pharmacy_info.district_profile + ")").attr('selected', true).trigger('change');
                }
                if (pharma.pharmacy_info.comments !== "") {
                    document.forms[0].elements["comments"].value = pharma.pharmacy_info.comments
                }
                if (pharma.pharmacy_info.pharmacist_first_name !== "") {
                    document.forms[0].elements["pharmacist_first_name"].value = pharma.pharmacy_info.pharmacist_first_name
                }
                if (pharma.pharmacy_info.pharmacist_last_name !== "") {
                    document.forms[0].elements["pharmacist_last_name"].value = pharma.pharmacy_info.pharmacist_last_name
                }
                if (pharma.pharmacy_info.tests_available.length !== 0) {

                    for (var i=0; i< pharma.pharmacy_info.tests_available.length; i++){
                    $('#tests').dropdown('set selected', pharma.pharmacy_info.tests_available[i]);
                    // $("#tests option:contains(" + pharma.pharmacy_info.tests_available[i] + ")").attr('selected', true).trigger('change');
                    }
                }
                // if (bask.basket.insurance !== "") {
                //     $("#insurance option:contains(" + bask.basket.insurance + ")").attr('selected', true).trigger('change');
                // }
                // if (bask.basket.Age !== "") {
                //     document.forms[0].elements["Age"].value = bask.basket.Age
                // }

            });


                fetchCampaigns()
                document.getElementById("global_name").innerHTML = localStorage.getItem('campaign')
                document.getElementById("session_name").innerHTML = localStorage.getItem('session')
            }
            else {
                //   user must login
                window.location.assign("/accounts/login/");
            }
        }



function initForm() {


}
    </script>
    <script>
        function savePharmacy() {
            var pharmname = document.getElementById("pharmacy_name").value
            var things = $('#pharmform').form('get values')
        // let pharmacy = {"name":pharm.name,"email":pharm.pharmacy_info.pharmacy_email,"contact":pharm.pharmacy_info.pharmacist_contact,"area_name":pharm.pharmacy_info.area_name,"detailed_address":pharm.pharmacy_info.detailed_address,"pharmacist_first_name":pharm.pharmacy_info.pharmacist_first_name,"pharmacist_last_name":pharm.pharmacy_info.pharmacist_last_name,"average_patients_per_day":parseInt(pharm.pharmacy_info.average_patients_per_day),"insurance_convention":pharm.pharmacy_info.insurance_convention,"pharmacy_standard":pharm.pharmacy_info.pharmacy_standard,"district_social_standard":pharm.pharmacy_info.district_social_standard,"district_profile":pharm.pharmacy_info.district_profile,"conselling":pharm.pharmacy_info.counselling.length==3,"computerized":pharm.pharmacy_info.computerized.length==3,"test":pharm.pharmacy_info.tests_available,"staff_mostly_followed":pharm.pharmacy_info.staff_mostly_followed,"staff_mostly_present":pharm.pharmacy_info.staff_mostly_present,"dependent_on_hospital":pharm.pharmacy_info.dependent_on_hospital.length==3,"comments":pharm.pharmacy_info.comments}
        console.log(things)
        db.pharmacies.put({name:pharmname, pharmacy_info: things})
        $('body')
                .toast({
                    title: 'Success',

                    message: 'Pharmacy Updated!',
                    class: 'orange',
                    className: {
                        toast: 'ui big message'
                    }
                });

            localStorage.setItem('pharmacy_name', pharmname)
                window.location.assign("/campaigns/new-basket/");
        }
//         axios.post('/api/v1/campaigns/create-pharmacy/', things)
//         .then(function (response) {
//             console.log(response.data)
//             if(typeof response.data == 'number'){
//             console.log(response.data)
//             let pharmid = parseInt(response.data)
//             localStorage.setItem("pharm_id", pharmid)
//             localStorage.setItem('pharmacy_name', pharmname)
//             // var data = $('#pharmform').serializeArray().reduce(function (obj, item) {
//             //     obj[item.name] = item.value;
//             //     return obj;
//             // }, {});

//             $('body')
//                 .toast({
//                     title: 'Success',

//                     message: 'Pharmacy Created!',
//                     class: 'orange',
//                     className: {
//                         toast: 'ui big message'
//                     }
//                 });
//             window.location.assign("/campaigns/new-session/");
//             } else if  (typeof response.data == 'object'){
//                 console.log(response.data)
//                 $('body')
//                   .toast({
//                     class: 'error',
//                     position: 'top left',
//                     displayTime: 'auto',
//                     message: `A Pharmacy Exists with the Same Name!`
//                   });
//             }
// })



//         console.log('done')}




    </script>

    <script src="/static/js/axios.min.js"></script>
    <script src="/static/js/campaign.js"></script>
    <script src="/static/js/login.js"></script>





</body>

</html>